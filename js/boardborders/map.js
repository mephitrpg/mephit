var map=[
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00001','00000','00000','00000','00000','00000','00000','10000','00000','00000','00000','00000','00000','00000','00000','10000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00001','00000','00000','00000','01010','00000','00000','10000','10000','10000','10000','00000','00000','00000','00000','10000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00100','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','10000','10000','10000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00100','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
['00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000','00000'],		 
];

// ruoto la mappa di 90° per comodità, in modo da poter scrivere map[x][y] anzichè map[y][x];
// identifico i muri e li listo nell'oggetto "wall"

var wall={};
(function(){
	var m=[];
	var rows=map.length;
	for(var r=0;r<rows;r++){
		var cols=map[r].length;
		for(var c=0;c<cols;c++){
			var v=map[r][c],x=c,y=r;
			if(typeof m[x]=="undefined")m[x]=[];
			if(v!=0){
				if(typeof wall[x]=="undefined")wall[x]={};
				wall[x][y]=v;
			}
			m[x][y]=v;
		}
	}
	map=m;
})();

var stopIf={
	N:['0010','1010','0110','0011','1110','0111','1011'],
	E:['0001','1001','0101','0011','1101','0111','1011'],
	S:['1000','1100','1010','1001','1110','1101','1011'],
	W:['0100','1100','0110','0101','1110','1101','0111']
}
var stopIfOpposite={
	N:['1000','1100','1001','1101'],
	E:['0100','1100','0110','1110'],
	S:['0010','0110','0011','0111'],
	W:['0001','1001','0011','1011']
}

function checkWall(x,y,dir){
	
	// controllo i casi più semplici
	if(typeof map[x]=="undefined")return {show:0,stop:1,id:-1,visibleBorders:'0000'};
	if(typeof map[x][y]=="undefined")return {show:0,stop:1,id:-1,visibleBorders:'0000'};
	var code=map[x][y];
	if(code=='00000')return {show:1,stop:0,id:code,visibleBorders:'1111'};
	if(code=='10000')code='11111';
	
	var bordoMuro={N:code[1]=='1',E:code[2]=='1',S:code[3]=='1',W:code[4]=='1'};
	
	//casella pg
	if(x==PG.x&&y==PG.y){
		switch(dir.name){
			case"N":case"E":case"S":case"W":
				if(bordoMuro[dir.name])return {show:1,stop:1,id:code,visibleBorders:'1111'}
			break;
		}
	}
	
	//altre caselle
	switch(dir.name){
		case"N":
			if(bordoMuro.S)return {show:0,stop:1,id:code,visibleBorders:'0010'}
			if(bordoMuro.N)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
		break;
		case"E":
			if(bordoMuro.W)return {show:0,stop:1,id:code,visibleBorders:'0001'}
			if(bordoMuro.E)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
		break;
		case"S":
			if(bordoMuro.N)return {show:0,stop:1,id:code,visibleBorders:'1000'}
			if(bordoMuro.S)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
		break;
		case"W":
			if(bordoMuro.E)return {show:0,stop:1,id:code,visibleBorders:'0100'}
			if(bordoMuro.W)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
		break;
	}
	/*
	switch(dir.name){
		case"N":case"E":case"S":case"W":
			var conditionalRoundX=function(q){return Math.round(q);}
			var conditionalRoundY=function(q){return Math.round(q);}
		break;
		case"NE":
			var conditionalRoundX=function(q){return Math.floor(q);}
			var conditionalRoundY=function(q){return Math.ceil(q);}
		break;
		case"SE":
			var conditionalRoundX=function(q){return Math.floor(q);}
			var conditionalRoundY=function(q){return Math.floor(q);}
		break;
		case"SW":
			var conditionalRoundX=function(q){return Math.ceil(q);}
			var conditionalRoundY=function(q){return Math.floor(q);}
		break;
		case"NW":
			var conditionalRoundX=function(q){return Math.ceil(q);}
			var conditionalRoundY=function(q){return Math.ceil(q);}
		break;
	}
	*/
	// controllo i casi più complessi.
	// per prima cosa verifico quali sono i lati della cella attraversati dal raggio
	var cell_x=mapToWorld(x);
	var cell_y=mapToWorld(y);
	
	var AX=dir.startX-mapToWorld(origin.x)
	var AY=dir.startY-mapToWorld(origin.y)
	var BX=dir.endX-mapToWorld(origin.x)
	var BY=dir.endY-mapToWorld(origin.y)
	
	
	var passaPer={N:false,E:false,S:false,W:false};
	if(bordoMuro.N){	//lato N
//		var X_retta_lato_cell=conditionalRoundX((cell_y-dir.q)/dir.m);
		var X_retta_lato_cell=Math.floor((cell_y-dir.q)/dir.m);
		passaPer.N=(X_retta_lato_cell>=cell_x&&X_retta_lato_cell<=cell_x+cside);
	}
	if(bordoMuro.E){	//lato E
//		var Y_retta_lato_cell=conditionalRoundY(dir.m*(cell_x+cside)+dir.q);
		var Y_retta_lato_cell=Math.floor(dir.m*(cell_x+cside)+dir.q);
		passaPer.E=(Y_retta_lato_cell>=cell_y&&Y_retta_lato_cell<=cell_y+cside);
	}
	if(bordoMuro.S){	//lato S
//		var X_retta_lato_cell=conditionalRoundX((cell_y+cside-dir.q)/dir.m);
		var X_retta_lato_cell=Math.floor((cell_y+cside-dir.q)/dir.m);
		passaPer.S=(X_retta_lato_cell>=cell_x&&X_retta_lato_cell<=cell_x+cside);
	}
	if(bordoMuro.W){	//lato W
//		var Y_retta_lato_cell=conditionalRoundY(dir.m*(cell_x)+dir.q);
		var Y_retta_lato_cell=Math.floor(dir.m*(cell_x)+dir.q);
//		console.log("["+x+","+y+"]",cell_y,Y_retta_lato_cell,cell_y+cside,Y_retta_lato_cell>=cell_y&&Y_retta_lato_cell<=cell_y+cside)
		passaPer.W=(Y_retta_lato_cell>=cell_y&&Y_retta_lato_cell<=cell_y+cside);
	}
	
	// in base alla direzione decido se mostrare lati o tile della cella
	//
	//tiraNaRigaRossa(AX,AY,BX,BY)
	
	//casella pg
	if(x==PG.x&&y==PG.y){
		switch(dir.name){
			case"NE"://270~315~360 |/_
				
				if(passaPer.N&&bordoMuro.N)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				if(passaPer.E&&bordoMuro.E)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				return {show:1,stop:0,id:code,visibleBorders:'1111'}
				
			break;
			case"NW"://180~225~270 _\|
				
				if(passaPer.N&&bordoMuro.N)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				if(passaPer.W&&bordoMuro.W)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				return {show:1,stop:0,id:code,visibleBorders:'1111'}
				
			break;
			case"SW"://90~135~180 ¯/|
				
				if(passaPer.S&&bordoMuro.S)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				if(passaPer.W&&bordoMuro.W)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				return {show:1,stop:0,id:code,visibleBorders:'1111'}
				
			break;
			case"SE"://0~45~90 |\¯
				
				if(passaPer.S&&bordoMuro.S)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				if(passaPer.E&&bordoMuro.E)return {show:1,stop:1,id:code,visibleBorders:'1111'}
				return {show:1,stop:0,id:code,visibleBorders:'1111'}
				
			break;
		}
	}
	
	//altre caselle
	switch(dir.name){
		case"NE"://270~315~360 |/_
			
			//tiraNaRigaRossa(AX,AY,BX,BY)
			
			if(passaPer.S&&bordoMuro.S)return {show:0,stop:1,id:code,visibleBorders:'0010'}
			if(passaPer.W&&bordoMuro.W)return {show:0,stop:1,id:code,visibleBorders:'0001'}
			if(passaPer.N&&bordoMuro.N)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			if(passaPer.E&&bordoMuro.E)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
			
		break;
		case"NW"://180~225~270 _\|
			
			//tiraNaRigaRossa(AX,AY,BX,BY)
			//var pp=(passaPer.N?"N":"n")+(passaPer.E?"E":"e")+(passaPer.S?"S":"s")+(passaPer.W?"W":"w");
			//console.log("=",dir.name,dir.a)
			
			if(passaPer.S&&bordoMuro.S)return {show:0,stop:1,id:code,visibleBorders:'0010'}
			if(passaPer.E&&bordoMuro.E)return {show:0,stop:1,id:code,visibleBorders:'0100'}
			if(passaPer.N&&bordoMuro.N)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			if(passaPer.W&&bordoMuro.W)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
			
		break;
		case"SW"://90~135~180 ¯/|
			
			//tiraNaRigaRossa(AX,AY,BX,BY)
			//var pp=(passaPer.N?"N":"n")+(passaPer.E?"E":"e")+(passaPer.S?"S":"s")+(passaPer.W?"W":"w");
			//console.log("=",dir.name,dir.a)
			
			if(passaPer.N&&bordoMuro.N)return {show:0,stop:1,id:code,visibleBorders:'1000'}
			if(passaPer.E&&bordoMuro.E)return {show:0,stop:1,id:code,visibleBorders:'0100'}
			if(passaPer.S&&bordoMuro.S)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			if(passaPer.W&&bordoMuro.W)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
			
		break;
		case"SE"://0~45~90 |\¯
			
			//tiraNaRigaRossa(AX,AY,BX,BY)
			
			if(passaPer.N&&bordoMuro.N)return {show:0,stop:1,id:code,visibleBorders:'1000'}
			if(passaPer.W&&bordoMuro.W)return {show:0,stop:1,id:code,visibleBorders:'0001'}
			if(passaPer.S&&bordoMuro.S)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			if(passaPer.E&&bordoMuro.E)return {show:1,stop:1,id:code,visibleBorders:'1111'}
			return {show:1,stop:0,id:code,visibleBorders:'1111'}
			
		break;
	}
	
//	return code!='00000'?{show:1,stop:1,id:code,visibleBorders:'1111'}:{show:1,stop:0,id:code,visibleBorders:'1111'};
}